###########################################################################################################################
# Copyright (c) 2023, ANTOBOT LTD.
# All rights reserved.

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
#
# Description: 	parameters used for local standalone costmap (use with am_costmap_2d)     	  
# Contacts:     soyoung.kim@antobot.ai
#
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

#beyond this distance (in meters), the obstacle will not be put into the costmap.
obstacle_range: 10 

#The range at which sensor data is kept at higher resolution.
raytrace_range: 12

#The default maximum height of any obstacle to be inserted into the costmap in meters. This parameter should be set to be slightly higher than the height of your robot.
max_obstacle_height: 3.0 #meters

footprint: [[-0.62, -0.44], [0.62, -0.44], [0.62, 0.44], [-0.62, 0.44]]
robot_radius: 0.1 # robot radius should be small as 0.1 for updated Lathcoats 

#The static map layer represents a largely unchanging portion of the costmap, like those generated by SLAM.
static_layer:
    enabled: false
    map_topic: /map 
    subscribe_to_updates: true

#The obstacle layer tracks the obstacles as read by the sensor data.    
obstacle_layer:
    enabled: true
    combination_method: 1
    observation_sources:  pcl_front_laser_scan_sensor pcl_back_laser_scan_sensor
    pcl_front_laser_scan_sensor: {sensor_frame: zed2_front_left_camera_frame, data_type: LaserScan, topic: /camera/scan/front, marking: true, clearing: true, min_obstacle_height: -5.0, max_obstacle_height: 5.0, inf_is_valid: true, obstacle_range: 9.5, raytrace_range: 10.0}
    pcl_back_laser_scan_sensor: {sensor_frame: zed2_back_left_camera_frame, data_type: LaserScan, topic: /camera/scan/back, marking: true, clearing: true, min_obstacle_height: -5.0, max_obstacle_height: 5.0, inf_is_valid: true, obstacle_range: 9.5, raytrace_range: 10.0}
inflation_layer:
    enabled: true
    cost_scaling_factor:  5.0  # exponential rate at which the obstacle cost drops off (default: 10)
    inflation_radius:   0.2  # max. distance from an obstacle at which costs are incurred for planning paths.

# Note that global frame is set to base_link. this makes the local costmap to rotate when the robot is rotating. 
# using costmap_2d package with this setting had an issue of 'smearing'. Therefore, am_costmap_2d has been created (with modification)
global_frame: base_link
robot_base_frame: base_link

#update_frequency parameter determines the frequency, in Hz, at which the costmap will run its update loop
update_frequency: 5.0
#publish_frequency parameter determines the rate, in Hz, at which the costmap will publish visualization information.
publish_frequency: 2.0

#rolling_window parameter to true means that the costmap will remain centered around the robot as the robot moves through the world
rolling_window: true
always_send_full_costmap: true

track_unknown_space: false
#The width, height,and resolution parameters set the width (meters), height (meters), and resolution (meters/cell) of the costmap
width: 20.0
height: 20.0

resolution: 0.1

# For local costmap, we use am_costmap_2d. am_costmap_2d clears the costmap every time it updates.
# am_costmap_2d is only used for local costmap with global_frame set as base_link.
plugins: 
- {name: obstacle_layer,    type: "am_costmap_2d::am_ObstacleLayer"}
- {name: inflation_layer, type: "am_costmap_2d::InflationLayer"}
